# Blog Aggregator (gator)

A small CLI tool to aggregate RSS/Atom feeds into a Postgres-backed store.

## Features
- Register and switch users
- Add feeds and follow/unfollow feeds
- Periodically scrape feeds and persist posts
- Browse recent posts for a user

## Requirements
- Go 1.25+ (module uses `go 1.25.1`)
- PostgreSQL database
- `psql` (or another way to apply SQL migration files)

## Repository layout
- `main.go` — CLI entrypoint and command handlers
- `rss.go` — feed fetching & parsing
- `internal/config` — reads/writes `~/.gatorconfig.json`
- `internal/database` — generated `sqlc` DB queries and models
- `sql/schema` — SQL migration files (apply in order)

## Configuration
Create a config file at `~/.gatorconfig.json` with at least the `db_url` field. Example:

```json
{
  "db_url": "postgres://user:pass@localhost:5432/gator?sslmode=disable",
  "current_user_name": ""
}
```

The `register` command will set `current_user_name` when a new user is created. The CLI reads this file using the `config.Read()` helper.

## Database / Migrations
The SQL migration files are in `sql/schema`. They create the `users`, `feeds`, `feed_follows`, and `posts` tables. Apply them in order to your database. Example using `psql`:

```bash
# export your database URL (psql connection string)
export DATABASE_URL="postgres://user:pass@localhost:5432/gator?sslmode=disable"

# apply each migration in order
psql "$DATABASE_URL" -f sql/schema/001_users.sql
psql "$DATABASE_URL" -f sql/schema/003_feeds.sql
psql "$DATABASE_URL" -f sql/schema/005_feed_follows.sql
psql "$DATABASE_URL" -f sql/schema/006_add_last_fetched_at.sql
psql "$DATABASE_URL" -f sql/schema/007_add_posts.sql
```

Alternatively, use your preferred migration tool (goose, migrate, etc.) against the files in `sql/schema`.

## Build & Run
To build:

```bash
go build -o gator .
```

Run commands via the binary (or `go run . <cmd>`). The CLI expects a command as the first argument. Example usage:

```bash
# register a user (also sets current user in ~/.gatorconfig.json)
./gator register alice

# login as an existing user
./gator login alice

# list users
./gator users

# add feed (name and url)
./gator addfeed "Example Blog" https://example.com/feed.xml

# list all feeds
./gator feeds

# follow a feed by URL
./gator follow https://example.com/feed.xml

# list follows for current user
./gator following

# unfollow by URL
./gator unfollow https://example.com/feed.xml

# start aggregator: collect feeds every 30s
./gator agg 30s

# browse recent posts for current user (limit optional)
./gator browse 5

# reset users table (DANGEROUS: deletes users)
./gator reset
```

Notes:
- `register` creates a user and writes the username to `~/.gatorconfig.json`.
- `agg <duration>` runs a loop that fetches the next feed (round-robin) and stores new posts.

## Important files
- [main.go](main.go) — CLI and command implementations
- [rss.go](rss.go) — feed fetching
- [internal/config/config.go](internal/config/config.go) — config file handling
- [internal/database](internal/database) — generated sqlc queries
- [sql/schema](sql/schema) — migration SQL files

## Development
- Codegen: `internal/database` is generated by `sqlc` (see `sql/queries` & `sql/schema`).
- To run locally: ensure Postgres is running, apply migrations, set `~/.gatorconfig.json` `db_url`, then use `go run . <command>`.

## Contributing
PRs and issues welcome. If you add features, please include tests and update this README with any new configuration or runtime steps.

## License
No license file is included in this repository. Add `LICENSE` if you want to set a license.
